<div class="container">
  <!-- Cabe√ßalho -->
  <div class="header">
    <h1>üì¶ Gerenciador de Jogos de Tabuleiro</h1>
    <p>Gerencie sua cole√ß√£o de jogos de tabuleiro</p>
  </div>

  <!-- Filtros -->
  <mat-card class="filtros-card">
    <mat-card-header>
      <mat-card-title>Filtros</mat-card-title>
    </mat-card-header>
    
    <mat-card-content>
      <div class="filtros-grid">
        <!-- Nome -->
        <mat-form-field appearance="outline" class="filtro-item">
          <mat-label>Buscar jogo</mat-label>
          <input 
            matInput 
            [(ngModel)]="filtroNome" 
            (ngModelChange)="aplicarFiltros()"
            placeholder="Digite nome, descri√ß√£o ou tag"
          >
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <!-- Categoria -->
        <mat-form-field appearance="outline" class="filtro-item">
          <mat-label>Categoria</mat-label>
          <mat-select 
            [(ngModel)]="filtroCategoria" 
            (selectionChange)="aplicarFiltros()"
          >
            <mat-option [value]="">Todas</mat-option>
            @for (categoria of categorias(); track categoria) {
              <mat-option [value]="categoria">{{categoria}}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <!-- Disponibilidade -->
        <mat-form-field appearance="outline" class="filtro-item">
          <mat-label>Disponibilidade</mat-label>
          <mat-select 
            [(ngModel)]="filtroDisponivel" 
            (selectionChange)="aplicarFiltros()"
          >
            <mat-option [value]="null">Todos</mat-option>
            <mat-option [value]="true">Dispon√≠vel</mat-option>
            <mat-option [value]="false">Indispon√≠vel</mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Bot√µes -->
        <div class="filtro-botoes">
          <button 
            mat-stroked-button 
            (click)="limparFiltros()"
            class="limpar-btn"
          >
            <mat-icon>clear_all</mat-icon>
            Limpar Filtros
          </button>
          
          <button 
            mat-raised-button 
            color="primary" 
            routerLink="/jogos/novo"
            class="novo-btn"
          >
            <mat-icon>add</mat-icon>
            Novo Jogo
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Loading -->
  @if (loadingService.isLoadingSignal()) {
    <div class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>{{ loadingService.messageSignal() }}</p>
    </div>
  }

  <!-- Tabela -->
  @if (!loadingService.isLoadingSignal()) {
    <div class="tabela-container">
      <div class="tabela-header">
        <h3>
          Jogos Encontrados: {{ jogosFiltrados().length }}
          @if (jogosFiltrados().length !== jogos().length) {
            <span class="filtro-info">(filtrados de {{ jogos().length }})</span>
          }
        </h3>
      </div>

      <!-- Mensagem se n√£o houver resultados -->
      @if (jogosFiltrados().length === 0) {
        <mat-card class="nenhum-resultado">
          <mat-card-content>
            <mat-icon>search_off</mat-icon>
            <h3>Nenhum jogo encontrado</h3>
            <p>Tente ajustar os filtros ou adicionar um novo jogo.</p>
            <button mat-button color="primary" routerLink="/jogos/novo">
              <mat-icon>add</mat-icon>
              Adicionar Primeiro Jogo
            </button>
          </mat-card-content>
        </mat-card>
      } @else {
        <!-- Tabela Material -->
        <div class="mat-elevation-z8 tabela-wrapper">
          <table mat-table [dataSource]="jogosFiltrados()" class="jogos-table">
            
            <!-- Coluna Nome -->
            <ng-container matColumnDef="nome">
              <th mat-header-cell *matHeaderCellDef>Nome</th>
              <td mat-cell *matCellDef="let jogo">
                <div class="jogo-info">
                  <img 
                    [src]="jogo.imagemUrl" 
                    [alt]="jogo.nome"
                    class="jogo-imagem"
                    onerror="this.src='https://picsum.photos/100/100?random=0'"
                  >
                  <div>
                    <strong>{{ jogo.nome }}</strong>
                    <p class="jogo-descricao">{{ jogo.descricao | slice:0:100 }}...</p>
                    <div class="jogo-tags">
                      @for (tag of jogo.tags; track tag) {
                        <span class="tag">{{ tag }}</span>
                      }
                    </div>
                  </div>
                </div>
              </td>
            </ng-container>

            <!-- Coluna Categoria -->
            <ng-container matColumnDef="categoria">
              <th mat-header-cell *matHeaderCellDef>Categoria</th>
              <td mat-cell *matCellDef="let jogo">
                <span class="categoria-badge" [class]="jogo.categoria.toLowerCase()">
                  {{ jogo.categoria }}
                </span>
              </td>
            </ng-container>

            <!-- Coluna Jogadores -->
            <ng-container matColumnDef="jogadores">
              <th mat-header-cell *matHeaderCellDef>Jogadores</th>
              <td mat-cell *matCellDef="let jogo">
                <div class="info-cell">
                  <mat-icon>people</mat-icon>
                  <span>{{ formatarJogadores(jogo) }}</span>
                </div>
              </td>
            </ng-container>

            <!-- Coluna Tempo -->
            <ng-container matColumnDef="tempo">
              <th mat-header-cell *matHeaderCellDef>Tempo</th>
              <td mat-cell *matCellDef="let jogo">
                <div class="info-cell">
                  <mat-icon>schedule</mat-icon>
                  <span>{{ formatarTempo(jogo) }}</span>
                </div>
              </td>
            </ng-container>

            <!-- Coluna Pre√ßo -->
            <ng-container matColumnDef="preco">
              <th mat-header-cell *matHeaderCellDef>Pre√ßo</th>
              <td mat-cell *matCellDef="let jogo">
                <span class="preco">{{ jogo.preco | currency:'BRL':'symbol':'1.2-2' }}</span>
              </td>
            </ng-container>

            <!-- Coluna Complexidade -->
            <ng-container matColumnDef="complexidade">
              <th mat-header-cell *matHeaderCellDef>Complexidade</th>
              <td mat-cell *matCellDef="let jogo">
                <div class="complexidade">
                  <span class="estrelas" [title]="'N√≠vel ' + jogo.complexidade">
                    {{ formatarComplexidade(jogo.complexidade) }}
                  </span>
                  <span class="nivel">({{ jogo.complexidade }}/5)</span>
                </div>
              </td>
            </ng-container>

            <!-- Coluna Estoque -->
            <ng-container matColumnDef="estoque">
              <th mat-header-cell *matHeaderCellDef>Estoque</th>
              <td mat-cell *matCellDef="let jogo">
                <div class="estoque-cell" [class]="jogo.estoque > 5 ? 'alto' : jogo.estoque > 0 ? 'baixo' : 'esgotado'">
                  <mat-icon>inventory_2</mat-icon>
                  <span>{{ jogo.estoque }} un.</span>
                  @if (!jogo.disponivel) {
                    <span class="indisponivel-badge">INDISP.</span>
                  }
                </div>
              </td>
            </ng-container>

            <!-- Coluna A√ß√µes -->
            <ng-container matColumnDef="acoes">
              <th mat-header-cell *matHeaderCellDef>A√ß√µes</th>
              <td mat-cell *matCellDef="let jogo">
                <div class="acoes-botoes">
                  <button 
                    mat-icon-button 
                    color="primary" 
                    [routerLink]="['/jogos/editar', jogo.id]"
                    matTooltip="Editar"
                  >
                    <mat-icon>edit</mat-icon>
                  </button>
                  
                  <button 
                    mat-icon-button 
                    color="warn" 
                    (click)="confirmarExclusao(jogo)"
                    matTooltip="Excluir"
                  >
                    <mat-icon>delete</mat-icon>
                  </button>
                  
                  <button 
                    mat-icon-button 
                    color="accent"
                    [routerLink]="['/jogos', jogo.id]"
                    matTooltip="Ver detalhes"
                  >
                    <mat-icon>visibility</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>

            <!-- Linhas da tabela -->
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        </div>
      }
    </div>
  }
</div>